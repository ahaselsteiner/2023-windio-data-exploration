function datenum8601_test()
%
% (c) 2011-2020 Stephen Cobeldick
%
%fun = @(k,dvb,dve)datevec(k*datenum(dve)+(1-k)*datenum(dvb));
%
tmp = {'%s %3d','<a href="matlab:opentoline(''%1$s.m'',%2$3d)">%1$s %2$3d</a>'};
chk(tmp{1+feature('hotlinks')}) % reset counter
%
clock = [1999,1,3,15,6,48.0568];
now = datenum(clock);
spl = {'',''};
%
%% Examples Mfile Help
%
chk(now,spl, '1999-01-03 15:06:48.0568')
chk(now,spl, '1999003T150648.0568')
chk(now,spl, '1998W537_150648.0568')
chk([730123;730123;730123],{'A','B','C','D'}, 'A19990103B1999-003C1998-W53-7D')
chk(730123.6250,spl, '1999-003T15')
chk(730123,{'','T15'}, '1999-01-03T15','*ymd')
chk([1999,1,3,20,0,12],{'',''}, '19990103 200012')
chk([1999,1,3,0,0,0;2000,12,1,0,0,0],{'',' ',''}, '19990103 200012','_')
%
%% Examples Timestamp Tables
%
chk(fix(clock),spl, '19990103T150648',      'ymdHMS')
chk(fix(clock),spl, '1999-01-03T15:06:48', '*ymdHMS')
chk(fix(clock),spl, '1999003T150648',        'ynHMS')
chk(fix(clock),spl, '1999-003T15:06:48',    '*ynHMS')
chk(fix(clock),spl, '1998W537T150648',      'YWDHMS')
chk(fix(clock),spl, '1998-W53-7T15:06:48', '*YWDHMS')
% Reduced precision:
chk([1999,1,3,15,0,0],spl, '19990103T15',    'ymdH')
chk([1999,1,3,15,0,0],spl, '1999-01-03T15', '*ymdH')
chk([1999,1,3,0,0,0],spl, '1999003',          'yn')
chk([1999,1,3,0,0,0],spl, '1999-003',        '*yn')
% Separator character:
chk([1999,1,3,15,6,0],spl, '1999003_1506',    'yn_HM')
chk([1999,1,3,15,6,0],spl, '1999-003_15:06', '*yn_HM')
chk([1999,1,3,15,0,0],spl, '1998W537@15',    'YWD@H')
chk([1999,1,3,15,0,0],spl, '1998-W53-7@15', '*YWD@H')
% Decimal fraction:
chk([1999,1,3,15,6,46.800],spl, '1999003T15.113',    'ynH3') % fun(0.113,[1999,1,3,15,0,0],[1999,1,3,16,0,0])
chk([1999,1,3,15,6,46.800],spl, '1999-003T15.113',  '*ynH3') % fun(0.113,[1999,1,3,15,0,0],[1999,1,3,16,0,0])
chk([1999,1,3,15,6,46.080],spl, '1998W537.6297',    'YWD4') % fun(0.6297,[1999,1,3],[1999,1,4])
chk([1999,1,3,15,6,46.080],spl, '1998-W53-7.6297', '*YWD4') % fun(0.6297,[1999,1,3],[1999,1,4])
chk([1999,1,3,15,6,48.056],spl, '1999.0072047202',  'y10') % fun(0.0072047202,[1999,1,1],[2000,1,1])
chk([1999,1,3,15,6,48.056],spl, '1999.0072047202', '*y10') % fun(0.0072047202,[1999,1,1],[2000,1,1])
%
%% Check Calender Year
%
chk([2011,12,31,23,59,59.000],spl, '2012-00-31T23:59:59.000')
chk([2012,12, 1,23,59,59.000],spl, '2012-11-31T23:59:59.000')
chk([2012,12,31,23,59,59.000],spl, '2012-12-31T23:59:59.000')
chk([2013, 1, 1, 0, 0, 0.000],spl, '2012-12-31T23:59:60.000')
chk([2012, 4, 4, 5, 2, 2.170],spl, '2012-04-04T05:02:02.170')
chk([2012, 4, 5, 0, 0, 0.000],spl, '2012-04-04T24:00:00.000')
chk([2012, 4, 5, 0, 0, 0.500],spl, '2012-04-04T24:00:00.500')
chk([2012,12,31,10, 9, 0.000],spl, '2012-12-31T10:08:60.000')
chk([2013, 1, 1,12, 0, 0.000],spl, '2012-13-01T12:00:00.000')
chk([2013, 1, 1,12, 0, 0.000],spl, '2012-12-32T12:00:00.000')
chk([2013, 1, 1, 1, 0, 0.000],spl, '2012-12-31T25:00:00.000')
chk([2013, 1, 1, 0, 1, 0.000],spl, '2012-12-31T24:01:00.000')
chk([2012,12,31,13, 0, 0.000],spl, '2012-12-31T12:60:00.000')
chk([2012,12,31,12, 1, 0.000],spl, '2012-12-31T12:00:60.000')
chk([2012,11,30,23,59,59.000],spl, '2012-12-00T23:59:59.000')
chk([2012, 2,29,12, 0, 0.000],spl, '2012-02-29T12:00:00.000')
chk([2011, 3, 1,12, 0, 0.000],spl, '2011-02-29T12:00:00.000')
chk([2011, 3, 1,12, 0, 0.000],spl, '2011-03-01T12:00:00.000')
chk([2034, 3, 1, 0, 0, 0.000],spl, '2034-03-01T00:00:00.000')
chk([2034, 2,27,23,59,59.999],spl, '2034-02-27T23:59:59.999')
chk([2012, 1,29,12, 0, 0.000],spl, '2012-01-29T12:00:00.000')
chk([2012, 1,29,12, 0, 0.000],spl, '2012-01-29T12:00:00.000')
chk([2012, 1,29,12, 0, 0.000],spl, '2012-01-29T12:00:00.000')
chk([2012, 1,29,12, 0, 0.000],spl, '2012-01-29T12:00:00.000')
chk([2012, 1,29,12, 0, 0.000],spl, '2012-01-29T12:00:00.000')
chk([2012, 1,29,12, 0, 0.000],spl, '2012-01-29T12:00:00.000')
chk([2012, 1,29,12, 0, 0.000],spl, '2012-01-29T12:00:00.000')
chk([2012, 1,29,12, 0, 0.000],spl, '2012-01-29T12:00:00.000')
chk([2012, 1,29,12, 0, 0.000],spl, '2012-01-29T12:00:00.000')
chk([2012, 1,29,12, 0, 0.000],spl, '2012-01-29T12:00:00.000')

%% Check Week-Numbering Year
%
chk([2005, 1, 1, 0, 0, 0.000],spl, '2004-W53-6T00:00:00.000')
chk([2005, 1, 2, 0, 0, 0.000],spl, '2004-W53-7T00:00:00.000')
chk([2005,12,31, 0, 0, 0.000],spl, '2005-W52-6T00:00:00.000')
chk([2007, 1, 1, 0, 0, 0.000],spl, '2007-W01-1T00:00:00.000')
chk([2007,12,30, 0, 0, 0.000],spl, '2007-W52-7T00:00:00.000')
chk([2007,12,31, 0, 0, 0.000],spl, '2008-W01-1T00:00:00.000')
chk([2008, 1, 1, 0, 0, 0.000],spl, '2008-W01-2T00:00:00.000')
chk([2008,12,28, 0, 0, 0.000],spl, '2008-W52-7T00:00:00.000')
chk([2008,12,29, 0, 0, 0.000],spl, '2009-W01-1T00:00:00.000')
chk([2008,12,30, 0, 0, 0.000],spl, '2009-W01-2T00:00:00.000')
chk([2008,12,31, 0, 0, 0.000],spl, '2009-W01-3T00:00:00.000')
chk([2009, 1, 1, 0, 0, 0.000],spl, '2009-W01-4T00:00:00.000')
chk([2009,12,31, 0, 0, 0.000],spl, '2009-W53-4T00:00:00.000')
chk([2010, 1, 1, 0, 0, 0.000],spl, '2009-W53-5T00:00:00.000')
chk([2010, 1, 2, 0, 0, 0.000],spl, '2009-W53-6T00:00:00.000')
chk([2010, 1, 3, 0, 0, 0.000],spl, '2009-W53-7T00:00:00.000')
%
%% Check Trailing Fraction
%
chk([2000, 2,29, 0, 0, 0.9],spl, '2000-060T00:00:00.900',   '*ynHMS3')
chk([2000, 2,29, 0, 0.8, 0],spl, '2000-060T00:00.8000',     '*ynHM4')
chk([2000, 2,29, 0.7, 0, 0],spl, '2000-060T00.70000',       '*ynH5')
chk([2000, 2,29.6, 0, 0, 0],spl, '2000-060.600000',         '*yn6')
chk([2000, 2,29, 0, 0, 0.9],spl, '2000-02-29T00:00:00.900', '*ymdHMS3')
chk([2000, 2,29, 0, 0.8, 0],spl, '2000-02-29T00:00.8000',   '*ymdHM4')
chk([2000, 2,29, 0.7, 0, 0],spl, '2000-02-29T00.70000',     '*ymdH5')
chk([2000, 2,29.6, 0, 0, 0],spl, '2000-02-29.600000',       '*ymd6')
chk([2000, 2,15,  12, 0, 0],spl, '2000-02.5000000',         '*ym7') % fun(0.5,[2000,02,01],[2000,03,01])
chk([2000, 5,26,   9,36, 0],spl, '2000.40000000',           '*y8')  % fun(0.4,[2000,01,01],[2001,01,01])
chk([2000, 2,29, 0, 0, 0.9],spl, '2000-W09-2T00:00:00.900', '*YWDHMS3')
chk([2000, 2,29, 0, 0.8, 0],spl, '2000-W09-2T00:00.8000',   '*YWDHM4')
chk([2000, 2,29, 0.7, 0, 0],spl, '2000-W09-2T00.70000',     '*YWDH5')
chk([2000, 2,29.6, 0, 0, 0],spl, '2000-W09-2.600000',       '*YWD6')
chk([2000, 3, 2,  12, 0, 0],spl, '2000-W09.5000000',        '*YW7') % fun(0.5,[2000,02,28],[2000,03,06])
chk([2000, 5,27,  14,24, 0],spl, '2000.40000000',           '*Y8')  % fun(0.4,[2000,01,03],[2001,01,01])
%
%% Check Multiple Timestamps
%
chk([1998,1,1;1997,12,29;1999,1,1;1999,1,4;2000,1,1;2000,1,3;2001,1,1;2001,1,1],...
	{'A','B','C','D','E','F','G','H','I'},'A1998B1998WC1999D1999WE2000F2000WG2001H2001WI')
chk(repmat([1997,12,29],5,1),... % First day of year 1998W.
	{'A','B','C','D','E','F'},'A1998WB1998W01C1998-W01-1D1997-12-29E1997-363F')
chk(repmat([1999,01,04],5,1),... % First day of year 1999W.
	{'A','B','C','D','E','F'},'A1999WB1999-W01C1999W011D1999-01-04E1999-004F')
chk(repmat([2000,01,03],5,1),... % First day of year 2000W.
	{'A','B','C','D','E','F'},'A2000WB2000-W01C2000W011D2000-01-03E2000-003F')
chk(repmat([2001,01,01],5,1),... % First day of year 2001W.
	{'A','B','C','D','E','F'},'A2001WB2001-W01C2001W011D2001-01-01E2001-001F')
chk(repmat([1999,01,03],3,1),... % Last day of year 1998W.
	{'A','B','C','D'},'A1998-W53-7B1999-01-03C1999-003D')
chk(repmat([2000,01,02],3,1),... % Last day of year 1999W.
	{'A','B','C','D'},'A1999-W52-7B2000-01-02C2000-002D')
chk(repmat([2000,12,31],3,1),... % Last day of year 2000W.
	{'A','B','C','D'},'A2000-W52-7B2000-12-31C2000-366D') % leap year!
chk(repmat([2001,12,30],3,1),... % Last day of year 2001W.
	{'A','B','C','D'},'A2001-W52-7B2001-12-30C2001-364D')
chk(repmat([1998,03,30],5,1),... % First day of 2nd quarter of 1998W.
	{'A','B','C','D','E','F'},'A1998W14B1998-W14-1C1998-03-30D1998-089E1998-089.00000F')
chk(repmat([1999,04,05],5,1),... % First day of 2nd quarter of 1999W.
	{'A','B','C','D','E','F'},'A1999W14B1999-W14-1C1999-04-05D1999-095E1999-095.00000F')
chk(repmat([2000,04,03],5,1),... % First day of 2nd quarter of 2000W.
	{'A','B','C','D','E','F'},'A2000W14B2000-W14-1C2000-04-03D2000-094E2000-094.00000F')
chk(repmat([2001,04,02],5,1),... % First day of 2nd quarter of 2001W.
	{'A','B','C','D','E','F'},'A2001W14B2001-W14-1C2001-04-02D2001-092E2001-092.00000F')
%
%% https://en.wikipedia.org/wiki/ISO_8601
%
%%% General principles:
chk([2009,01,06],spl, '2009-01-06', '*ymd')
chk([2009,01,06],spl, '2009-01-06')
chk([2009,01,06],spl, '20090106',    'ymd')
chk([2009,01,06],spl, '20090106')
chk([2004,05,1], spl, '2004-05',     '*ym')
chk([2004,05,1], spl, '2004-05')
%%% Calendar dates:
chk('5 April 1981',spl, '1981-04-05', '*ymd')
chk('5 April 1981',spl, '1981-04-05')
chk('5 April 1981',spl, '19810405',    'ymd')
chk('5 April 1981',spl, '19810405')
%%% Week dates:
chk('29 December 2008',spl, '2009-W01-1', '*YWD')
chk('29 December 2008',spl, '2009-W01-1')
chk(  '3 January 2010',spl, '2009-W53-7', '*YWD')
chk(  '3 January 2010',spl, '2009-W53-7')
%%% Ordinal dates:
chk('1981-04-05',spl, '1981-095',    '*yn')
chk('1981-04-05',spl, '1981-095')
%
%% https://en.wikipedia.org/wiki/ISO_week_date
%
chk(repmat( '1 Jan 2005',2,1),{'','!',''}, '2005-01-01!2004-W53-6')
chk(repmat( '2 Jan 2005',2,1),{'','!',''}, '2005-01-02!2004-W53-7')
chk(repmat('31 Dec 2005',2,1),{'','!',''}, '2005-12-31!2005-W52-6')
chk(repmat( '1 Jan 2006',2,1),{'','!',''}, '2006-01-01!2005-W52-7')
chk(repmat( '2 Jan 2006',2,1),{'','!',''}, '2006-01-02!2006-W01-1')
chk(repmat('31 Dec 2006',2,1),{'','!',''}, '2006-12-31!2006-W52-7')
chk(repmat( '1 Jan 2007',2,1),{'','!',''}, '2007-01-01!2007-W01-1')
chk(repmat('30 Dec 2007',2,1),{'','!',''}, '2007-12-30!2007-W52-7')
chk(repmat('31 Dec 2007',2,1),{'','!',''}, '2007-12-31!2008-W01-1')
chk(repmat( '1 Jan 2008',2,1),{'','!',''}, '2008-01-01!2008-W01-2')
chk(repmat('28 Dec 2008',2,1),{'','!',''}, '2008-12-28!2008-W52-7')
chk(repmat('29 Dec 2008',2,1),{'','!',''}, '2008-12-29!2009-W01-1')
chk(repmat('30 Dec 2008',2,1),{'','!',''}, '2008-12-30!2009-W01-2')
chk(repmat('31 Dec 2008',2,1),{'','!',''}, '2008-12-31!2009-W01-3')
chk(repmat( '1 Jan 2009',2,1),{'','!',''}, '2009-01-01!2009-W01-4')
chk(repmat('31 Dec 2009',2,1),{'','!',''}, '2009-12-31!2009-W53-4')
chk(repmat( '1 Jan 2010',2,1),{'','!',''}, '2010-01-01!2009-W53-5')
chk(repmat( '2 Jan 2010',2,1),{'','!',''}, '2010-01-02!2009-W53-6')
chk(repmat( '3 Jan 2010',2,1),{'','!',''}, '2010-01-03!2009-W53-7')
%
%% https://github.com/uli-weltersbach/ISO-8601-Week-Dates/blob/master/WeekDates.Tests/WeekDateTests.cs
%
chk('2005-01-02',spl, '2004-W53-7')
chk('2005-12-31',spl, '2005-W52-6')
chk('2007-01-01',spl, '2007-W01-1')
chk('2007-12-30',spl, '2007-W52-7')
chk('2007-12-31',spl, '2008-W01-1')
chk('2008-01-01',spl, '2008-W01-2')
chk('2008-12-28',spl, '2008-W52-7')
chk('2008-12-29',spl, '2009-W01-1')
chk('2008-12-30',spl, '2009-W01-2')
chk('2008-12-31',spl, '2009-W01-3')
chk('2009-01-01',spl, '2009-W01-4')
chk('2009-12-31',spl, '2009-W53-4')
chk('2010-01-01',spl, '2009-W53-5')
chk('2010-01-02',spl, '2009-W53-6')
chk('2010-01-03',spl, '2009-W53-7')
chk('2013-12-28',spl, '2013-W52-6')
chk('2013-12-29',spl, '2013-W52-7')
chk('2013-12-30',spl, '2014-W01-1')
chk('2013-12-31',spl, '2014-W01-2')
chk('2005-01-02',spl, '2004-W53-7', '*YWD')
chk('2005-12-31',spl, '2005-W52-6', '*YWD')
chk('2007-01-01',spl, '2007-W01-1', '*YWD')
chk('2007-12-30',spl, '2007-W52-7', '*YWD')
chk('2007-12-31',spl, '2008-W01-1', '*YWD')
chk('2008-01-01',spl, '2008-W01-2', '*YWD')
chk('2008-12-28',spl, '2008-W52-7', '*YWD')
chk('2008-12-29',spl, '2009-W01-1', '*YWD')
chk('2008-12-30',spl, '2009-W01-2', '*YWD')
chk('2008-12-31',spl, '2009-W01-3', '*YWD')
chk('2009-01-01',spl, '2009-W01-4', '*YWD')
chk('2009-12-31',spl, '2009-W53-4', '*YWD')
chk('2010-01-01',spl, '2009-W53-5', '*YWD')
chk('2010-01-02',spl, '2009-W53-6', '*YWD')
chk('2010-01-03',spl, '2009-W53-7', '*YWD')
chk('2013-12-28',spl, '2013-W52-6', '*YWD')
chk('2013-12-29',spl, '2013-W52-7', '*YWD')
chk('2013-12-30',spl, '2014-W01-1', '*YWD')
chk('2013-12-31',spl, '2014-W01-2', '*YWD')
%
chk()
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%datenum8601_test
function chk(dtx,lps, varargin)
%
persistent itr cnt fmt fnm
switch nargin
case 0
	fprintf('%s: %d of %d testcases failed.\n',fnm,cnt,itr)
	return
case 1
	itr = 0;
	cnt = 0;
	fmt = dtx;
	fnm = mfilename();
	return
end
itr = itr+1;
%
if size(dtx,2)>1
	dtx = datenum(dtx);
end
%
try %#ok<TRYNC>
	[out,spl] = datenum8601(varargin{:});
end
%
if any(abs(out(:)-dtx(:))>1e-8) || ~all(strcmp(lps(:),spl(:)))
	cnt = cnt+1;
	db = dbstack();
	s1 = sprintf(', %#.15g',out);
	s2 = sprintf(', %#.15g',dtx);
	fprintf(fmt, fnm, db(2).line);
	fprintf('\noutput:%s\nexpect:%s\n', s1(2:end), s2(2:end));
end
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%chk